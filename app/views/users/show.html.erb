<% content_for :head do %>
  <script type="text/javascript">
    function discard_baseinfo(){
      $('#base-info').html( $.ajax({url: "load_baseinfo/me",async: false}).responseText );
    }
    function edit_base_info(){
      $('#base-info').html( $.ajax({url: "edit_baseinfo/me",async: false}).responseText );
      $('form.baseinfo').submit(function() {//点击submit的函数
        $(this).ajaxSubmit({//点击submit发起ajax请求
          target: '#base-info',  //目标是对base-info的dom进行局部更新
          clearForm: true,
          //success: DeleteProduct,
          error: displayError//发生错误,譬如validate?为false时
        });
        return false;
      });
      return false;
    }
    function displayError(request, errorType) {
      var msg = '' +
    '<div class="ui-widget error" style="float:left;">' +
        '<div class="ui-state-error ui-corner-all" style="padding: 0 .7em;">' +
            '<p style="margin:0.5em;"><span class="ui-icon ui-icon-alert" style="float: left; margin-right: .3em;"></span>' +
            '<strong>出错了:</strong> ' + request.responseText + '(请检查输入数据项，修改密码长度不能少于5) </p>' +
        '</div>' +
    '</div>';

      $('#base-info').append(msg)
      $('.error').click(function(){$(this).hide()})
    }

  </script>
<% end %>
<% @body_id = 'users' %>
<h1><%= t("my_account") %></h1>
<% hook :account_summary do %>
  <div class="profiles-info">
    <div id="base-info">
      <%= render 'show_baseinfo' %>
    </div>
    <hr/>

    <% if @user.profile
      pf = @user.profile
    %>
<div class="info-title">
  <h3>详细资料</h3>
  <%= link_to t('edit'), profiles_url %>
</div>
      <table style="width:auto;">
        <tr>
          <td>客户名称：</td>
          <td><%= pf.jbxx_khmc %></td>
        </tr>
        <tr>
          <td>联系电话：</td>
          <td><%= pf.jbxx_dh %></td>
        </tr>
        <tr>
          <td>公司传真：</td>
          <td><%= pf.jbxx_cz %></td>
        </tr>
      </table>
    <% else %>
    <h2>详细资料</h2>
      <p>您尚未填写详细信息。您可以填写详细信息后，通过审核成为酷购正式会员。正式会员可以直接查看酷购平台中所有手机的报价，
        并且酷购客服会专门为您专业信息和推荐。
      </p>
      <p><%= link_to '点击这里填写详细信息', profiles_url, :class => 'button protrusion-btn' %></p>


    <% end %>

  <% end %>

  <% hook :account_my_orders do %>
    <hr/>
    <h2><%= t("my_orders") %></h2>

    <table class="order-summary" width="545">
      <thead>
        <tr>
          <th><%= t("order_number") %></th>
          <th><%= t("order_date") %></th>
          <th><%= t("status") %></th>
          <th><%= t("customer") %></th>
          <th><%= t("total") %></th>
        </tr>
      </thead>
      <tbody>
        <% @orders.each do |order| %>
          <tr class="<%= cycle('even', 'odd') %>">
            <td><%= link_to order.number, order_url(order) %></td>
            <td><%=order.created_at.to_date%></td>
            <td><%= t(order.state).titleize %></td>
            <td><%= order.user.email if order.user %></td>
            <td><%= number_to_currency order.total %></td>
          </tr>
        <% end %>
      </tbody>
    </table>

    <br />
  </div>
<% end %>
